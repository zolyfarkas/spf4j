<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JDiffRunner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">spf4j-jdiff-maven-plugin</a> &gt; <a href="index.source.html" class="el_package">org.spf4j.jdiff</a> &gt; <span class="el_source">JDiffRunner.java</span></div><h1>JDiffRunner.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2017 SPF4J.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.spf4j.jdiff;

import org.spf4j.jdiff.utils.Compress;
import com.google.common.util.concurrent.UncheckedExecutionException;
import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
import java.io.BufferedWriter;
import java.io.File;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.UncheckedIOException;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.Collection;
import java.util.Collections;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.TreeSet;
import java.util.stream.Stream;
import org.apache.maven.artifact.Artifact;
import org.apache.maven.execution.MavenSession;
import org.apache.maven.plugin.MojoExecution;
import org.apache.maven.toolchain.ToolchainManager;
import org.codehaus.plexus.util.FileUtils;
import org.eclipse.aether.RepositorySystem;
import org.eclipse.aether.RepositorySystemSession;
import org.eclipse.aether.repository.RemoteRepository;
import org.eclipse.aether.resolution.ArtifactResolutionException;
import org.eclipse.aether.resolution.DependencyResolutionException;
import org.eclipse.aether.resolution.VersionRangeResolutionException;
import org.eclipse.aether.version.Version;
import org.spf4j.maven.MavenRepositoryUtils;

/**
 * @author Zoltan Farkas
 */
@SuppressFBWarnings(&quot;AFBR_ABNORMAL_FINALLY_BLOCK_RETURN&quot;)
public final class JDiffRunner {

  private final String docletPath;

  private final String javadocExec;

  private final List&lt;RemoteRepository&gt; remoteRepos;

  private final RepositorySystem repositorySystem;
  private final RepositorySystemSession reposSession;

  public JDiffRunner() {
<span class="fc" id="L67">    this(null, null, null, Collections.singletonList(MavenRepositoryUtils.getDefaultRepository()),</span>
<span class="fc" id="L68">            MavenRepositoryUtils.getRepositorySystem(), System.getProperty(&quot;spf4j.jdiff.javadocExec&quot;));</span>
<span class="fc" id="L69">  }</span>

  @SuppressFBWarnings(&quot;STT_TOSTRING_STORED_IN_FIELD&quot;)
  public JDiffRunner(final MojoExecution mojoExec, final ToolchainManager toolchainManager,
          final MavenSession session,
          final List&lt;RemoteRepository&gt; remoteRepos,
          final RepositorySystem repositorySystem,
<span class="fc" id="L76">          final String javadocExec) {</span>
<span class="fc" id="L77">    this.remoteRepos = remoteRepos;</span>
<span class="fc" id="L78">    this.repositorySystem = repositorySystem;</span>
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">    if (session != null) {</span>
<span class="nc" id="L80">      this.reposSession = session.getRepositorySession();</span>
    } else {
<span class="fc" id="L82">      this.reposSession = MavenRepositoryUtils.getRepositorySystemSession(</span>
<span class="fc" id="L83">              MavenRepositoryUtils.getRepositorySystem(),</span>
<span class="fc" id="L84">              new File(System.getProperty(&quot;user.home&quot;), &quot;.m2/repository&quot;));</span>
    }
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">    if (mojoExec != null) {</span>
<span class="nc" id="L87">      StringBuilder cp = new StringBuilder(32);</span>
<span class="nc" id="L88">      Map&lt;String, Artifact&gt; artifactMap = mojoExec.getMojoDescriptor().getPluginDescriptor().getArtifactMap();</span>
<span class="nc" id="L89">      cp.append(artifactMap.get(&quot;jdiff:jdiff&quot;).getFile().getAbsolutePath());</span>
<span class="nc" id="L90">      cp.append(File.pathSeparatorChar);</span>
<span class="nc" id="L91">      cp.append(artifactMap.get(&quot;xerces:xercesImpl&quot;).getFile().getAbsolutePath());</span>
<span class="nc" id="L92">      cp.append(File.pathSeparatorChar);</span>
<span class="nc" id="L93">      docletPath = cp.toString();</span>
<span class="nc" id="L94">    } else {</span>
      try {
<span class="fc" id="L96">        Set&lt;File&gt; artf1 = MavenRepositoryUtils.resolveArtifactAndDependencies(</span>
                &quot;runtime&quot;, &quot;jdiff&quot;, &quot;jdiff&quot;, null, &quot;jar&quot;, &quot;1.0.9&quot;, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L98">        Set&lt;File&gt; artf2 = MavenRepositoryUtils.resolveArtifactAndDependencies(</span>
                &quot;runtime&quot;, &quot;xerces&quot;, &quot;xercesImpl&quot;, null, &quot;jar&quot;, &quot;2.10.0&quot;, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L100">        artf1.addAll(artf2);</span>
<span class="fc" id="L101">        docletPath = MavenRepositoryUtils.toPath(artf1);</span>
<span class="nc" id="L102">      } catch (DependencyResolutionException ex) {</span>
<span class="nc" id="L103">        throw new UncheckedExecutionException(ex);</span>
<span class="fc" id="L104">      }</span>
    }

<span class="pc bpc" id="L107" title="1 of 2 branches missed.">    if (javadocExec == null) {</span>
<span class="pc bpc" id="L108" title="1 of 2 branches missed.">      if (toolchainManager == null) {</span>
<span class="fc" id="L109">        String home = System.getProperty(&quot;java.home&quot;);</span>
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">        if (home.contains(&quot;jre&quot;)) {</span>
<span class="fc" id="L111">          this.javadocExec = home + &quot;/../bin/javadoc&quot;;</span>
        } else {
<span class="nc" id="L113">          this.javadocExec = home + &quot;/bin/javadoc&quot;;</span>
        }
<span class="fc" id="L115">      } else {</span>
<span class="nc" id="L116">        this.javadocExec = toolchainManager.getToolchainFromBuildContext(&quot;jdk&quot;, session).findTool(&quot;javadoc&quot;);</span>
      }
    } else {
<span class="nc" id="L119">      this.javadocExec = javadocExec;</span>
    }

<span class="fc" id="L122">  }</span>

  public Set&lt;String&gt; generateJDiffXML(final Collection&lt;File&gt; sources,
          final Collection&lt;File&gt; classPath,
          final File destinationFolder,
          final String apiName,
          final Collection&lt;String&gt; includePackageNames)
          throws JavadocExecutionException, IOException {
    try {
<span class="fc" id="L131">      Files.createDirectories(destinationFolder.toPath());</span>
<span class="fc" id="L132">      JavadocExecutor javadoc = new JavadocExecutor(javadocExec);</span>

<span class="fc" id="L134">      javadoc.addArgumentPair(&quot;doclet&quot;, &quot;jdiff.JDiff&quot;);</span>
<span class="fc" id="L135">      javadoc.addArgumentPair(&quot;docletpath&quot;, docletPath);</span>
<span class="fc" id="L136">      javadoc.addArgumentPair(&quot;apiname&quot;, apiName);</span>
<span class="fc" id="L137">      javadoc.addArgumentPair(&quot;apidir&quot;, destinationFolder.getAbsolutePath());</span>
<span class="fc" id="L138">      javadoc.addArgumentPair(&quot;classpath&quot;, MavenRepositoryUtils.toPath(classPath));</span>
<span class="fc" id="L139">      javadoc.addArgumentPair(&quot;sourcepath&quot;, MavenRepositoryUtils.toPath(sources));</span>

<span class="fc" id="L141">      Set&lt;String&gt; pckgs = new TreeSet&lt;String&gt;();</span>

<span class="pc bpc" id="L143" title="1 of 4 branches missed.">      if (includePackageNames != null &amp;&amp; !includePackageNames.isEmpty()) {</span>
<span class="fc" id="L144">        pckgs.addAll(includePackageNames);</span>
      } else {
<span class="fc" id="L146">        pckgs = JDiffUtils.getPackages(sources);</span>
      }

<span class="fc bfc" id="L149" title="All 2 branches covered.">      for (String pckg : pckgs) {</span>
<span class="fc" id="L150">        javadoc.addArgument(pckg);</span>
<span class="fc" id="L151">      }</span>
<span class="fc" id="L152">      javadoc.execute(destinationFolder);</span>
<span class="fc" id="L153">      return pckgs;</span>
<span class="nc" id="L154">    } catch (IOException e) {</span>
<span class="nc" id="L155">      throw new JavadocExecutionException(e.getMessage(), e);</span>
    }
  }

  public void generateReport(final File srcDir, final String oldApi, final String newApi,
          final String javadocOld, final String javadocNew, final Set&lt;String&gt; packages,
          final File destinationDir) throws JavadocExecutionException, IOException {
<span class="fc" id="L162">    Files.createDirectories(destinationDir.toPath());</span>
    /**
     * javadoc -doclet jdiff.JDiff -docletpath ..\..\lib\jdiff.jar -d newdocs -stats -oldapi &quot;SuperProduct 1.0&quot; -newapi
     * &quot;SuperProduct 2.0&quot; -javadocold &quot;../../olddocs/&quot; -javadocnew &quot;../../newdocs/&quot; ..\..\lib\Null.java
     */
<span class="fc" id="L167">    JavadocExecutor javadoc = new JavadocExecutor(javadocExec);</span>
<span class="fc" id="L168">    javadoc.addArgument(&quot;-private&quot;);</span>
<span class="fc" id="L169">    javadoc.addArgumentPair(&quot;d&quot;, destinationDir.getAbsolutePath());</span>
<span class="fc" id="L170">    String absolutePath = srcDir.getAbsolutePath();</span>
<span class="fc" id="L171">    javadoc.addArgumentPair(&quot;oldapidir&quot;, absolutePath);</span>
<span class="fc" id="L172">    javadoc.addArgumentPair(&quot;newapidir&quot;, absolutePath);</span>
<span class="pc bpc" id="L173" title="1 of 2 branches missed.">    if (javadocOld != null) {</span>
<span class="fc" id="L174">      javadoc.addArgumentPair(&quot;javadocold&quot;, javadocOld);</span>
    }
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">    if (javadocNew != null) {</span>
<span class="fc" id="L177">      javadoc.addArgumentPair(&quot;javadocnew&quot;, javadocNew);</span>
    }
<span class="fc" id="L179">    javadoc.addArgumentPair(&quot;doclet&quot;, &quot;jdiff.JDiff&quot;);</span>
<span class="fc" id="L180">    javadoc.addArgumentPair(&quot;docletpath&quot;, docletPath);</span>
<span class="fc" id="L181">    javadoc.addArgumentPair(&quot;oldapi&quot;, oldApi);</span>
<span class="fc" id="L182">    javadoc.addArgumentPair(&quot;newapi&quot;, newApi);</span>
<span class="fc" id="L183">    javadoc.addArgument(&quot;-stats&quot;);</span>
<span class="fc bfc" id="L184" title="All 2 branches covered.">    for (String pckg : packages) {</span>
<span class="fc" id="L185">      javadoc.addArgument(pckg);</span>
<span class="fc" id="L186">    }</span>
<span class="fc" id="L187">    javadoc.execute(destinationDir);</span>
<span class="fc" id="L188">  }</span>

  public void runDiffBetweenReleases(final String groupId, final String artifactId,
          final String versionRange, final File destinationFolder, final int maxNrOFDiffs)
          throws DependencyResolutionException, VersionRangeResolutionException,
          IOException, ArtifactResolutionException, JavadocExecutionException {
<span class="fc" id="L194">    JDiffRunner jdiff = new JDiffRunner();</span>
<span class="fc" id="L195">    List&lt;Version&gt; rangeVersions = MavenRepositoryUtils.getVersions(</span>
            groupId, artifactId, versionRange, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L197">    int size = rangeVersions.size();</span>
<span class="pc bpc" id="L198" title="1 of 2 branches missed.">    if (size &lt; 2) {</span>
<span class="nc" id="L199">      return;</span>
    }
<span class="fc" id="L201">    LinkedList&lt;Version&gt; versions = new LinkedList&lt;&gt;();</span>
<span class="fc" id="L202">    versions.add(rangeVersions.get(size - 1));</span>
<span class="pc bpc" id="L203" title="1 of 4 branches missed.">    for (int i = size - 2, j = 1; i &gt;= 0 &amp;&amp; j &lt; maxNrOFDiffs; i--) {</span>
<span class="fc" id="L204">      Version ver = rangeVersions.get(i);</span>
<span class="fc bfc" id="L205" title="All 2 branches covered.">      if (ver.toString().contains(&quot;SNAPSHOT&quot;)) {</span>
<span class="fc" id="L206">        continue;</span>
      }
<span class="fc" id="L208">      versions.addFirst(ver);</span>
<span class="fc" id="L209">      j++;</span>
    }
<span class="fc" id="L211">    Version v = versions.get(0);</span>
<span class="fc" id="L212">    File prevSourcesArtifact = MavenRepositoryUtils.resolveArtifact(</span>
<span class="fc" id="L213">            groupId, artifactId, &quot;sources&quot;, &quot;jar&quot;, v.toString(), remoteRepos, repositorySystem, reposSession);</span>
<span class="fc" id="L214">    File prevJavaDocArtifact = MavenRepositoryUtils.resolveArtifact(</span>
<span class="fc" id="L215">            groupId, artifactId, &quot;javadoc&quot;, &quot;jar&quot;, v.toString(), remoteRepos, repositorySystem, reposSession);</span>
<span class="fc" id="L216">    Path tempDir = Files.createTempDirectory(&quot;jdiff&quot;);</span>
    try {
<span class="fc" id="L218">      Path sourceDestination = tempDir.resolve(artifactId).resolve(v.toString()).resolve(&quot;sources&quot;);</span>
<span class="fc" id="L219">      Compress.unzip(prevSourcesArtifact.toPath(), sourceDestination);</span>
<span class="fc" id="L220">      Set&lt;File&gt; deps = MavenRepositoryUtils.resolveArtifactAndDependencies(&quot;compile&quot;, groupId, artifactId,</span>
<span class="fc" id="L221">              null, &quot;jar&quot;, v.toString(), remoteRepos, repositorySystem, reposSession);</span>
<span class="fc" id="L222">      String prevApiName = artifactId + '-' + v;</span>
<span class="fc" id="L223">      Set&lt;String&gt; prevPackages = jdiff.generateJDiffXML(Collections.singletonList(sourceDestination.toFile()),</span>
              deps, destinationFolder, prevApiName, null);
<span class="fc bfc" id="L225" title="All 2 branches covered.">      for (int i = 1, l = versions.size(); i &lt; l; i++) {</span>
<span class="fc" id="L226">        v = versions.get(i);</span>
<span class="fc" id="L227">        File sourceArtifact = MavenRepositoryUtils.resolveArtifact(</span>
<span class="fc" id="L228">                groupId, artifactId, &quot;sources&quot;, &quot;jar&quot;, v.toString(), remoteRepos, repositorySystem, reposSession);</span>
<span class="fc" id="L229">        File javadocArtifact = MavenRepositoryUtils.resolveArtifact(</span>
<span class="fc" id="L230">                groupId, artifactId, &quot;javadoc&quot;, &quot;jar&quot;, v.toString(), remoteRepos, repositorySystem, reposSession);</span>
<span class="fc" id="L231">        sourceDestination =  tempDir.resolve(artifactId).resolve(v.toString()).resolve(&quot;sources&quot;);</span>
<span class="fc" id="L232">        Compress.unzip(sourceArtifact.toPath(), sourceDestination);</span>
<span class="fc" id="L233">        deps = MavenRepositoryUtils.resolveArtifactAndDependencies(&quot;compile&quot;, groupId, artifactId,</span>
<span class="fc" id="L234">                null, &quot;jar&quot;, v.toString(), remoteRepos, repositorySystem, reposSession);</span>
<span class="fc" id="L235">        String apiName = artifactId + '-' + v;</span>
<span class="fc" id="L236">        Set&lt;String&gt; packages = jdiff.generateJDiffXML(Collections.singletonList(sourceDestination.toFile()), deps,</span>
                destinationFolder, apiName, null);
<span class="fc" id="L238">        prevPackages.addAll(packages);</span>
<span class="fc" id="L239">        Path reportsDestination = destinationFolder.toPath().resolve(prevApiName + '_' + apiName);</span>
<span class="fc" id="L240">        Compress.unzip(prevJavaDocArtifact.toPath(), reportsDestination.resolve(prevApiName));</span>
<span class="fc" id="L241">        Compress.unzip(javadocArtifact.toPath(), reportsDestination.resolve(apiName));</span>

<span class="fc" id="L243">        jdiff.generateReport(destinationFolder, prevApiName, apiName,</span>
<span class="fc" id="L244">                &quot;../&quot; + prevApiName + '/', &quot;../&quot; + apiName + '/', prevPackages, reportsDestination.toFile());</span>
<span class="fc" id="L245">        prevApiName = apiName;</span>
<span class="fc" id="L246">        prevPackages = packages;</span>
<span class="fc" id="L247">        prevJavaDocArtifact = javadocArtifact;</span>
      }
    } finally {
<span class="fc" id="L250">      FileUtils.deleteDirectory(tempDir.toFile());</span>
    }
<span class="fc" id="L252">  }</span>

  public void runDiffBetweenReleases(final String groupId, final String artifactId,
          final String version1, final String version2, final File destinationFolder,
          final Set&lt;String&gt; includePackages)
          throws ArtifactResolutionException, DependencyResolutionException, IOException, JavadocExecutionException {
<span class="fc" id="L258">    JDiffRunner jdiff = new JDiffRunner();</span>
<span class="fc" id="L259">    File prevSourcesArtifact = MavenRepositoryUtils.resolveArtifact(</span>
            groupId, artifactId, &quot;sources&quot;, &quot;jar&quot;, version1, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L261">    File prevJavaDocArtifact = MavenRepositoryUtils.resolveArtifact(</span>
            groupId, artifactId, &quot;javadoc&quot;, &quot;jar&quot;, version1, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L263">    Path tempDir = Files.createTempDirectory(&quot;jdiff&quot;);</span>
    try {
<span class="fc" id="L265">      Path sourceDestination = tempDir.resolve(artifactId).resolve(version1).resolve(&quot;sources&quot;);</span>
<span class="fc" id="L266">      Compress.unzip(prevSourcesArtifact.toPath(), sourceDestination);</span>
<span class="fc" id="L267">      Set&lt;File&gt; deps = MavenRepositoryUtils.resolveArtifactAndDependencies(&quot;compile&quot;, groupId, artifactId,</span>
              null, &quot;jar&quot;, version1, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L269">      String prevApiName = artifactId + '-' + version1;</span>
<span class="fc" id="L270">      Set&lt;String&gt; prevPackages = jdiff.generateJDiffXML(Collections.singletonList(sourceDestination.toFile()),</span>
              deps, destinationFolder, prevApiName, includePackages);

<span class="fc" id="L273">      File sourceArtifact = MavenRepositoryUtils.resolveArtifact(</span>
              groupId, artifactId, &quot;sources&quot;, &quot;jar&quot;, version2, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L275">      File javadocArtifact = MavenRepositoryUtils.resolveArtifact(</span>
              groupId, artifactId, &quot;javadoc&quot;, &quot;jar&quot;, version2, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L277">      sourceDestination = tempDir.resolve(artifactId).resolve(version2).resolve(&quot;sources&quot;);</span>
<span class="fc" id="L278">      Compress.unzip(sourceArtifact.toPath(), sourceDestination);</span>
<span class="fc" id="L279">      deps = MavenRepositoryUtils.resolveArtifactAndDependencies(&quot;compile&quot;, groupId, artifactId,</span>
              null, &quot;jar&quot;, version2, remoteRepos, repositorySystem, reposSession);
<span class="fc" id="L281">      String apiName = artifactId + '-' + version2;</span>
<span class="fc" id="L282">      Set&lt;String&gt; packages = jdiff.generateJDiffXML(Collections.singletonList(sourceDestination.toFile()), deps,</span>
              destinationFolder, apiName, includePackages);
<span class="fc" id="L284">      prevPackages.addAll(packages);</span>
<span class="fc" id="L285">      Compress.unzip(prevJavaDocArtifact.toPath(), destinationFolder.toPath().resolve(prevApiName));</span>
<span class="fc" id="L286">      Compress.unzip(javadocArtifact.toPath(), destinationFolder.toPath().resolve(apiName));</span>

<span class="fc" id="L288">      jdiff.generateReport(destinationFolder, prevApiName, apiName,</span>
              &quot;../&quot; + prevApiName + '/', &quot;../&quot; + apiName + '/', prevPackages, destinationFolder);
    } finally {
<span class="fc" id="L291">      FileUtils.deleteDirectory(tempDir.toFile());</span>
    }
<span class="fc" id="L293">  }</span>

  public void writeChangesIndexHtml(final File reportOutputDirectory, final String fileName) throws IOException {
<span class="fc" id="L296">    try (BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(</span>
<span class="fc" id="L297">            Files.newOutputStream(reportOutputDirectory.toPath().resolve(fileName)),</span>
            StandardCharsets.UTF_8))) {
<span class="fc" id="L299">      writer.append(&quot;&lt;HTML&gt;\n&quot;</span>
              + &quot;&lt;HEAD&gt;\n&quot;
              + &quot;&lt;TITLE&gt;\n&quot;
              + &quot;API Differences Reports\n&quot;
              + &quot;&lt;/TITLE&gt;\n&quot;
              + &quot;&lt;/HEAD&gt;\n&quot;
              + &quot;&lt;BODY&gt;\n&quot;
              + &quot;&lt;table summary=\&quot;Api Difference Reports\&quot;&quot;
              + &quot; width=\&quot;100%\&quot; border=\&quot;0\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot;&gt;&quot;);
<span class="fc" id="L308">      Path reportPath = reportOutputDirectory.toPath();</span>
<span class="fc" id="L309">      try (Stream&lt;Path&gt; stream = Files.walk(reportPath, 2)) {</span>
<span class="fc" id="L310">        stream.map((p) -&gt; reportPath.relativize(p))</span>
<span class="fc bfc" id="L311" title="All 4 branches covered.">                .filter((p) -&gt; p.getNameCount() &gt; 1 &amp;&amp; p.endsWith(&quot;changes.html&quot;))</span>
<span class="fc" id="L312">                .forEach((p) -&gt; {</span>
                  try {
<span class="fc" id="L314">                    writer.append(&quot;  &lt;tr&gt;\n&quot;</span>
                            + &quot;  &lt;td bgcolor=\&quot;#FFFFCC\&quot;&gt;\n&quot;
                            + &quot;    &lt;font size=\&quot;+1\&quot;&gt;&lt;a href=\&quot;&quot; + p + &quot;\&quot;&gt; &quot;
<span class="fc" id="L317">                            + p.getName(0).toString().replace(&quot;_&quot;, &quot; to &quot;) + &quot; &lt;/a&gt;&lt;/font&gt;\n&quot;</span>
                            + &quot;  &lt;/td&gt;\n&quot;
                            + &quot;  &lt;/tr&gt;&quot;);
<span class="nc" id="L320">                  } catch (IOException ex) {</span>
<span class="nc" id="L321">                    throw new UncheckedIOException(ex);</span>
<span class="fc" id="L322">                  }</span>
<span class="fc" id="L323">                });</span>
      }
<span class="fc" id="L325">      writer.append(&quot;&lt;/TABLE&gt;\n&quot;</span>
              + &quot;&lt;/BODY&gt;\n&quot;
              + &quot;&lt;/HTML&gt;&quot;);
    }
<span class="fc" id="L329">  }</span>

  @Override
  public String toString() {
<span class="nc" id="L333">    return &quot;JDiffRunner{&quot; + &quot;docletPath=&quot; + docletPath + &quot;, javadocExec=&quot; + javadocExec</span>
            + &quot;, remoteRepos=&quot; + remoteRepos + &quot;, repositorySystem=&quot; + repositorySystem
            + &quot;, reposSession=&quot; + reposSession + '}';
  }



}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>