<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/logging.md at 2020-02-08
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200208" />
    <meta http-equiv="Content-Language" content="en" />
    <title>spf4j-8.7.5-SNAPSHOT &#x2013; Logging</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>SPF4J</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2020-02-08<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 8.7.5-SNAPSHOT</li>
      <li class="pull-right"><a href="./" title="SPF4J">SPF4J</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Main Menu</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="http://search.maven.org/#search|ga|1|spf4j" class="externalLink" title="Download"><span class="none"></span>Download</a></li>
      <li class="nav-header">Modules</li>
    <li><a href="spf4j-aether/index.html" title="spf4j-aether"><span class="none"></span>spf4j-aether</a></li>
    <li><a href="spf4j-asm/index.html" title="spf4j-asm"><span class="none"></span>spf4j-asm</a></li>
    <li><a href="spf4j-config-discovery-maven-plugin/index.html" title="spf4j-config-discovery-maven-plugin"><span class="none"></span>spf4j-config-discovery-maven-plugin</a></li>
    <li><a href="spf4j-jdiff-maven-plugin/index.html" title="spf4j-jdiff-maven-plugin"><span class="none"></span>spf4j-jdiff-maven-plugin</a></li>
    <li><a href="spf4j-core/index.html" title="spf4j-core"><span class="none"></span>spf4j-core</a></li>
    <li><a href="spf4j-slf4j-test/index.html" title="spf4j-slf4j-test"><span class="none"></span>spf4j-slf4j-test</a></li>
    <li><a href="spf4j-joda/index.html" title="spf4j-joda"><span class="none"></span>spf4j-joda</a></li>
    <li><a href="spf4j-core-gwt/index.html" title="spf4j-core-gwt"><span class="none"></span>spf4j-core-gwt</a></li>
    <li><a href="spf4j-junit/index.html" title="spf4j-junit"><span class="none"></span>spf4j-junit</a></li>
    <li><a href="spf4j-jmh/index.html" title="spf4j-jmh"><span class="none"></span>spf4j-jmh</a></li>
    <li><a href="spf4j-ui/index.html" title="spf4j-ui"><span class="none"></span>spf4j-ui</a></li>
    <li><a href="spf4j-aspects/index.html" title="spf4j-aspects"><span class="none"></span>spf4j-aspects</a></li>
    <li><a href="spf4j-zel/index.html" title="spf4j-zel"><span class="none"></span>spf4j-zel</a></li>
    <li><a href="spf4j-avro-components/index.html" title="spf4j-avro-components"><span class="none"></span>spf4j-avro-components</a></li>
    <li><a href="spf4j-jacoco-aggregate/index.html" title="spf4j-jacoco-aggregate"><span class="none"></span>spf4j-jacoco-aggregate</a></li>
    <li><a href="spf4j-maven-schema-resolver/index.html" title="spf4j-maven-schema-resolver"><span class="none"></span>spf4j-maven-schema-resolver</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Logging</h1>
<div class="section">
<h2><a name="Overview"></a>Overview</h2>
<p>Logging is a core aspect of every application. The recommended approach to logging is <a class="externalLink" href="https://stackify.com/what-is-structured-logging-and-why-developers-need-it/">structured logging</a>.</p>
<p>To have have efficient and structured logging, your application needs to log to files. (The console is not ideal for structured data due to various libraries, including JVM using it for messages in various formats&#x2026;) One good approach is to log to avro binary files compressed with snappy. An additional benefit is that you can leverage your hadoop stack to analyze your logs. The log record schema is described <a class="externalLink" href="https://zolyfarkas.github.io/core-schema/avrodoc.html#/schema/org.spf4j.base.avro.LogRecord">at</a></p>
<p>Let&#x2019;s look at how logging structured data is done in detail:</p>
<ul>

<li>Let&#x2019;s call the demo app endpoint with debug logging on:</li>
</ul>

<div>
<div>
<pre class="source">curl -X POST &quot;https://demo.spf4j.org/avql/query&quot; -H &quot;accept: application/json&quot; -H &quot;log-level: DEBUG&quot; -H &quot;Content-Type: text/plain&quot; -d &quot;select * from planets&quot;
</pre></div></div>

<ul>

<li>And take a look at <a class="externalLink" href="https://demo.spf4j.org/logs/cluster?_Accept=application/json">logs</a>:</li>
</ul>

<div>
<div>
<pre class="source">{
  &quot;origin&quot;: &quot;jaxrs-spf4j-demo-5f846dbdc8-nmg2k:/var/log/jaxrs-spf4j-demo-5f846dbdc8-nmg2k_2020-02-08.avro:7622&quot;,
  &quot;trId&quot;: &quot;XNm4uQJip.1.12uqj7.m0l&quot;,
  &quot;level&quot;: &quot;INFO&quot;,
  &quot;ts&quot;: &quot;2020-02-08T12:28:22.848Z&quot;,
  &quot;logger&quot;: &quot;org.spf4j.demo.resources.aql.PlanetsResourceImpl-&gt;getData&quot;,
  &quot;thr&quot;: &quot;http:8080-worker-2&quot;,
  &quot;msg&quot;: &quot;returning&quot;,
  &quot;xtra&quot;: [[
    {
    &quot;name&quot;: &quot;earth&quot;,
    &quot;planetClass&quot;: &quot;M&quot;,
    &quot;age&quot;: 512731872312,
    &quot;description&quot;: &quot;&quot;
    },
    {
    &quot;name&quot;: &quot;vulcan&quot;,
    &quot;planetClass&quot;: &quot;M&quot;,
    &quot;age&quot;: 612731872312,
    &quot;description&quot;: &quot;&quot;
    },
    {
    &quot;name&quot;: &quot;andoria&quot;,
    &quot;planetClass&quot;: &quot;M&quot;,
    &quot;age&quot;: 602731872312,
    &quot;description&quot;: &quot;&quot;
    }
  ]],
  &quot;attrs&quot;: {
  &quot;origLevel&quot;: &quot;DEBUG&quot;
  }
},

</pre></div></div>

<ul>

<li>Let&#x2019;s look at the <a class="externalLink" href="https://github.com/zolyfarkas/spf4j-jaxrs/blob/master/spf4j-jaxrs-server/src/main/java/org/spf4j/jaxrs/server/Spf4jInterceptionService.java#L150">code</a> that logs the above:</li>
</ul>

<div>
<div>
<pre class="source">  import org.spf4j.log.ExecContextLogger;
  import org.slf4j.Logger;
  import org.slf4j.LoggerFactory;
  ...
  log = new ExecContextLogger(LoggerFactory.getLogger(&quot;org.spf4j.demo.resources.aql.PlanetsResourceImpl-&gt;getData&quot;));
  ...
  log.debug(&quot;returning&quot;, result);
</pre></div></div>

<ul>

<li>

<p>The wrapping of the slf4j logger with ExecContextLogger allows us to enable debug logging at request level (-H &#x201c;log-level: DEBUG&#x201d;).</p>
</li>
<li>

<p>In the log.debug statement, the result object is not part of he message format as such instead of being dropped by logback (by default), it is logged in json format. Any parameter that is not an argument for the message format will be logged in json format. This is implemented using <a class="externalLink" href="https://github.com/zolyfarkas/spf4j/blob/master/spf4j-core/src/main/java/org/spf4j/base/Slf4jMessageFormatter.java">Slf4jMessageFormatter.java</a> and the and appender <a class="externalLink" href="https://github.com/zolyfarkas/spf4j-logback">from</a>.</p>
</li>
</ul></div>
<div class="section">
<h2><a name="Components"></a>Components</h2>
<div class="section">
<h3><a name="Test_logger"></a>Test logger</h3>
<p>A slf4j logging backend that is optimal to be used for your unit and integration tests. It minimizes the amount of useless detail spewed to the console by providing it only on test failure, allows you to assert your logging behavior and more. For more detail <a class="externalLink" href="http://www.spf4j.org/spf4j-slf4j-test/index.html">see</a></p></div>
<div class="section">
<h3><a name="Avro_and_json_logback_encoders_and_appenders"></a>Avro and json logback encoders and appenders</h3>
<ul>

<li>log to avro binary files. see<a class="externalLink" href="https://zolyfarkas.github.io/core-schema/avrodoc.html#/schema/org.spf4j.base.avro.LogRecord">schema</a></li>
<li><a class="externalLink" href="https://github.com/zolyfarkas/spf4j-logback/blob/master/src/main/java/org/spf4j/log/AvroLogbackEncoder.java">Json Encoder</a> to use with any lockback appender.</li>
</ul>
<p>Logging to console as it is being rec</p></div>
<div class="section">
<h3><a name="Utilities_in_spf4-core_library"></a>Utilities in spf4-core library</h3>
<ul>

<li>High performance <a class="externalLink" href="https://github.com/zolyfarkas/spf4j/blob/master/spf4j-core/src/main/java/org/spf4j/log/SLF4JBridgeHandler.java">java.util -&gt; slf4j bridge</a></li>
<li>High performance and more flexible <a class="externalLink" href="https://github.com/zolyfarkas/spf4j/blob/master/spf4j-core/src/main/java/org/spf4j/base/Slf4jMessageFormatter.java">Slf4j message formatter</a>.</li>
<li>Execution Context aware <a class="externalLink" href="https://github.com/zolyfarkas/spf4j/blob/master/spf4j-core/src/main/java/org/spf4j/log/ExecContextLogger.java">logging wrapper</a> for &#x201c;DEBUG on error&#x201d; logging.</li>
<li>A more compact and richer string representation of stack traces. <a class="externalLink" href="https://github.com/zolyfarkas/spf4j/blob/master/spf4j-core/src/main/java/org/spf4j/base/Throwables.java">see</a></li>
</ul></div>
<div class="section">
<h3><a name="REST_endpoints_for_serving_your_logs:"></a>REST endpoints for serving your logs:</h3>
<ul>

<li><a class="externalLink" href="https://github.com/zolyfarkas/spf4j-jaxrs/tree/master/spf4j-jaxrs-actuator/src/main/java/org/spf4j/actuator/logs">process level log serving.</a></li>
<li><a class="externalLink" href="https://github.com/zolyfarkas/spf4j-jaxrs/tree/master/spf4j-jaxrs-actuator-cluster/src/main/java/org/spf4j/actuator/cluster/logs">cluster level log serving.</a></li>
</ul></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2020
<a href="http://www.spf4j.org">SPF4J</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
