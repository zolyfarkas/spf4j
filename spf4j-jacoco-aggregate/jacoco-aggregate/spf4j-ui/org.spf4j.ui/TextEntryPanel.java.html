<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>TextEntryPanel.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">spf4j-jacoco-aggregate</a> &gt; <a href="../index.html" class="el_bundle">spf4j-ui</a> &gt; <a href="index.source.html" class="el_package">org.spf4j.ui</a> &gt; <span class="el_source">TextEntryPanel.java</span></div><h1>TextEntryPanel.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2018 SPF4J.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.spf4j.ui;
//CHECKSTYLE:OFF
import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
import java.awt.datatransfer.DataFlavor;
import java.awt.datatransfer.StringSelection;
import java.awt.datatransfer.Transferable;
import java.awt.datatransfer.UnsupportedFlavorException;
import java.io.IOException;
import java.io.StringReader;
import java.io.UncheckedIOException;
import java.util.function.Consumer;
import javax.annotation.Nullable;
import javax.swing.JComponent;
import javax.swing.TransferHandler;
import javax.swing.text.BadLocationException;
import javax.swing.text.Document;
import javax.swing.text.JTextComponent;
import javax.swing.text.Position;
import org.spf4j.stackmonitor.SampleNode;

/**
 *
 * @author Zoltan Farkas
 */
@SuppressFBWarnings({&quot;SE_TRANSIENT_FIELD_NOT_RESTORED&quot;, &quot;SE_BAD_FIELD&quot;})
public class TextEntryPanel extends javax.swing.JPanel {

  private transient Consumer&lt;SampleNode&gt; nodeConsumer;

  private transient Consumer&lt;Exception&gt; errorConsumer;

  /**
   * Creates new form TextEntryPanel
   */
  public TextEntryPanel(final Consumer&lt;SampleNode&gt; nodeConsumer,
<span class="nc" id="L51">          final Consumer&lt;Exception&gt; errorConsumer) {</span>
<span class="nc" id="L52">    initComponents();</span>
<span class="nc" id="L53">    this.nodeConsumer = nodeConsumer;</span>
<span class="nc" id="L54">    this.errorConsumer = errorConsumer;</span>
<span class="nc" id="L55">    TextTransferHandler th = new TextTransferHandler();</span>
<span class="nc" id="L56">    jTextPane1.setTransferHandler(th);</span>
<span class="nc" id="L57">  }</span>

  /**
   * This method is called from within the constructor to initialize the form. WARNING: Do NOT modify this code. The
   * content of this method is always regenerated by the Form Editor.
   */
  @SuppressWarnings(&quot;unchecked&quot;)
  // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot;Generated Code&quot;&gt;//GEN-BEGIN:initComponents
  private void initComponents() {

<span class="nc" id="L67">    jScrollPane1 = new javax.swing.JScrollPane();</span>
<span class="nc" id="L68">    jTextPane1 = new javax.swing.JTextPane();</span>
<span class="nc" id="L69">    javax.swing.JButton display = new javax.swing.JButton();</span>

<span class="nc" id="L71">    jTextPane1.setRequestFocusEnabled(false);</span>
<span class="nc" id="L72">    jScrollPane1.setViewportView(jTextPane1);</span>

<span class="nc" id="L74">    display.setText(&quot;Display&quot;);</span>
<span class="nc" id="L75">    display.addActionListener(new java.awt.event.ActionListener() {</span>
      public void actionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc" id="L77">        displayActionPerformed(evt);</span>
<span class="nc" id="L78">      }</span>
    });

<span class="nc" id="L81">    javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);</span>
<span class="nc" id="L82">    this.setLayout(layout);</span>
<span class="nc" id="L83">    layout.setHorizontalGroup(</span>
<span class="nc" id="L84">      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)</span>
<span class="nc" id="L85">      .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()</span>
<span class="nc" id="L86">        .addComponent(jScrollPane1)</span>
<span class="nc" id="L87">        .addContainerGap())</span>
<span class="nc" id="L88">      .addGroup(layout.createSequentialGroup()</span>
<span class="nc" id="L89">        .addGap(152, 152, 152)</span>
<span class="nc" id="L90">        .addComponent(display)</span>
<span class="nc" id="L91">        .addContainerGap(186, Short.MAX_VALUE))</span>
    );
<span class="nc" id="L93">    layout.setVerticalGroup(</span>
<span class="nc" id="L94">      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)</span>
<span class="nc" id="L95">      .addGroup(layout.createSequentialGroup()</span>
<span class="nc" id="L96">        .addContainerGap()</span>
<span class="nc" id="L97">        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 256, javax.swing.GroupLayout.PREFERRED_SIZE)</span>
<span class="nc" id="L98">        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)</span>
<span class="nc" id="L99">        .addComponent(display)</span>
<span class="nc" id="L100">        .addContainerGap())</span>
    );
<span class="nc" id="L102">  }// &lt;/editor-fold&gt;//GEN-END:initComponents</span>

  @SuppressFBWarnings(&quot;UP_UNUSED_PARAMETER&quot;)
  private void displayActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_displayActionPerformed
    try {
<span class="nc" id="L107">      nodeConsumer.accept(SampleNode.parse(new StringReader(jTextPane1.getText())).getSecond());</span>
<span class="nc" id="L108">    } catch (IOException | RuntimeException ex) {</span>
<span class="nc" id="L109">      errorConsumer.accept(ex);</span>
<span class="nc" id="L110">    }</span>
<span class="nc" id="L111">  }//GEN-LAST:event_displayActionPerformed</span>


  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JScrollPane jScrollPane1;
  private javax.swing.JTextPane jTextPane1;
  // End of variables declaration//GEN-END:variables

<span class="nc" id="L119">  private static final class TextTransferHandler extends TransferHandler {</span>
    // Start and end position in the source text.
    // We need this information when performing a MOVE
    // in order to remove the dragged text from the source.

<span class="nc" id="L124">    Position p0 = null, p1 = null;</span>

    /**
     * Perform the actual import. This method supports both drag and drop and cut/copy/paste.
     */
    public boolean importData(TransferHandler.TransferSupport support) {
      // If we can't handle the import, bail now.
<span class="nc bnc" id="L131" title="All 2 branches missed.">      if (!canImport(support)) {</span>
<span class="nc" id="L132">        return false;</span>
      }

      // Fetch the data -- bail if this fails
      String data;
      try {
<span class="nc" id="L138">        data = (String) support.getTransferable().getTransferData(</span>
                DataFlavor.stringFlavor);
<span class="nc" id="L140">      } catch (UnsupportedFlavorException | java.io.IOException e) {</span>
<span class="nc" id="L141">        return false;</span>
<span class="nc" id="L142">      }</span>

<span class="nc" id="L144">      javax.swing.JTextPane tc = (javax.swing.JTextPane) support.getComponent();</span>
<span class="nc" id="L145">      tc.replaceSelection(data);</span>
<span class="nc" id="L146">      return true;</span>
    }

    /**
     * Bundle up the data for export.
     */
    @Nullable
    protected Transferable createTransferable(JComponent c) {
<span class="nc" id="L154">      javax.swing.JTextPane source = (javax.swing.JTextPane) c;</span>
<span class="nc" id="L155">      int start = source.getSelectionStart();</span>
<span class="nc" id="L156">      int end = source.getSelectionEnd();</span>
<span class="nc" id="L157">      Document doc = source.getDocument();</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">      if (start == end) {</span>
<span class="nc" id="L159">        return null;</span>
      }
      try {
<span class="nc" id="L162">        p0 = doc.createPosition(start);</span>
<span class="nc" id="L163">        p1 = doc.createPosition(end);</span>
<span class="nc" id="L164">      } catch (BadLocationException e) {</span>
<span class="nc" id="L165">        throw new RuntimeException(e);</span>
<span class="nc" id="L166">      }</span>
<span class="nc" id="L167">      String data = source.getSelectedText();</span>
<span class="nc" id="L168">      return new StringSelection(data);</span>
    }

    /**
     * These text fields handle both copy and move actions.
     */
    public int getSourceActions(JComponent c) {
<span class="nc" id="L175">      return COPY_OR_MOVE;</span>
    }

    /**
     * When the export is complete, remove the old text if the action was a move.
     */
    protected void exportDone(JComponent c, Transferable data, int action) {
<span class="nc bnc" id="L182" title="All 2 branches missed.">      if (action != MOVE) {</span>
<span class="nc" id="L183">        return;</span>
      }

<span class="nc bnc" id="L186" title="All 6 branches missed.">      if ((p0 != null) &amp;&amp; (p1 != null) &amp;&amp; (p0.getOffset() != p1.getOffset())) {</span>
        try {
<span class="nc" id="L188">          JTextComponent tc = (JTextComponent) c;</span>
<span class="nc" id="L189">          tc.getDocument()</span>
<span class="nc" id="L190">                  .remove(p0.getOffset(), p1.getOffset() - p0.getOffset());</span>
<span class="nc" id="L191">        } catch (BadLocationException e) {</span>
<span class="nc" id="L192">          throw new RuntimeException(e);</span>
<span class="nc" id="L193">        }</span>
      }
<span class="nc" id="L195">    }</span>

    /**
     * We only support importing strings.
     */
    public boolean canImport(TransferHandler.TransferSupport support) {
      // we only import Strings
<span class="nc bnc" id="L202" title="All 2 branches missed.">      if (!support.isDataFlavorSupported(DataFlavor.stringFlavor)) {</span>
<span class="nc" id="L203">        return false;</span>
      }
<span class="nc" id="L205">      return true;</span>
    }
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>